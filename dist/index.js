var t;t=function(){const t=.5*(Math.sqrt(3)-1),e=(3-Math.sqrt(3))/6,r=t=>0|Math.floor(t),i=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]);function n(t,e){let r=new o(t),i=()=>r.next();return i.double=()=>i()+11102230246251565e-32*(2097152*i()|0),i.int32=()=>4294967296*r.next()|0,i.quick=i,i}class o{constructor(t){null==t&&(t=+new Date);let e=4022871197;function r(t){t=String(t);for(let r=0;r<t.length;r++){e+=t.charCodeAt(r);let i=.02519603282416938*e;e=i>>>0,i-=e,i*=e,e=i>>>0,i-=e,e+=4294967296*i}return 2.3283064365386963e-10*(e>>>0)}this.c=1,this.s0=r(" "),this.s1=r(" "),this.s2=r(" "),this.s0-=r(t),this.s0<0&&(this.s0+=1),this.s1-=r(t),this.s1<0&&(this.s1+=1),this.s2-=r(t),this.s2<0&&(this.s2+=1)}next(){let{c:t,s0:e,s1:r,s2:i}=this,n=2091639*e+2.3283064365386963e-10*t;return this.s0=r,this.s1=i,this.s2=n-(this.c=0|n)}copy(t,e){return e.c=t.c,e.s0=t.s0,e.s1=t.s1,e.s2=t.s2,e}}let s=n(Math.random()),a=function(n=Math.random){const o=function(t){const e=new Uint8Array(512);for(let t=0;t<256;t++)e[t]=t;for(let r=0;r<255;r++){const i=r+~~(t()*(256-r)),n=e[r];e[r]=e[i],e[i]=n}for(let t=256;t<512;t++)e[t]=e[t-256];return e}(n),s=new Float64Array(o).map((t=>i[t%12*2])),a=new Float64Array(o).map((t=>i[t%12*2+1]));return function(i,n){let c=0,l=0,h=0;const f=(i+n)*t,u=r(i+f),g=r(n+f),m=(u+g)*e,x=i-(u-m),d=n-(g-m);let p,y;x>d?(p=1,y=0):(p=0,y=1);const v=x-p+e,_=d-y+e,b=x-1+2*e,E=d-1+2*e,w=255&u,R=255&g;let S=.5-x*x-d*d;if(S>=0){const t=w+o[R];S*=S,c=S*S*(s[t]*x+a[t]*d)}let A=.5-v*v-_*_;if(A>=0){const t=w+p+o[R+y];A*=A,l=A*A*(s[t]*v+a[t]*_)}let P=.5-b*b-E*E;if(P>=0){const t=w+1+o[R+1];P*=P,h=P*P*(s[t]*b+a[t]*E)}return 70*(c+l+h)}}(n(Math.random()));const c=(t=0,e=1)=>t+s()*(e-t),l=t=>t[~~(s()*t.length)];function h(t=0,e=1){return Array.isArray(t)?l(t):1===arguments.length?s()*t:c(t,e)}const f=(t,e)=>~~c(t,e),u=(t=0,e=1)=>{const r=1-s(),i=s();return Math.sqrt(-2*Math.log(r))*b(360*i)*e+t},g=t=>{let e=0;const r=[];for(const i in t)e+=t[i],r.push({key:i,cumulative:e});const i=s()*e;for(const{key:t,cumulative:e}of r)if(i<e)return isNaN(t)?t:parseInt(t)},m=(t,e,r,i,n,o=!1)=>{let s=i+(t-e)/(r-e)*(n-i);return o?i<n?x(s,i,n):x(s,n,i):s},x=(t,e,r)=>Math.max(Math.min(t,r),e),d=t=>(t%=360)<0?t+360:t,p=1440,y=2*Math.PI/p,v=new Float32Array(p).fill(NaN),_=new Float32Array(p).fill(NaN),b=t=>{const e=~~(4*d(t));let r=v[e];return isNaN(r)&&(r=Math.cos(e*y),v[e]=r),r},E=t=>{const e=~~(4*d(t));let r=_[e];return isNaN(r)&&(r=Math.sin(e*y),_[e]=r),r},w=t=>{let e=180*t/Math.PI%360;return e<0?e+360:e},R=(t,e,r,i,n)=>{let o=b(n),s=E(n);return{x:o*(r-t)+s*(i-e)+t,y:o*(i-e)-s*(r-t)+e}},S=(t,e,r,i)=>Math.hypot(r-t,i-e),A=(t,e,r,i)=>w(Math.atan2(-(i-e),r-t)),P=(t,e,r,i,n=!1)=>{let o=t.x,s=t.y,a=e.x,c=e.y,l=r.x,h=r.y,f=i.x,u=i.y;if(o===a&&s===c||l===f&&h===u)return!1;let g=a-o,m=c-s,x=f-l,d=u-h,p=d*g-x*m;if(0===p)return!1;let y=(x*(s-h)-d*(o-l))/p,v=(g*(s-h)-m*(o-l))/p;return!(!n&&(v<0||v>1))&&{x:o+y*g,y:s+y*m}},I=()=>{let t,e,r={};function i(){const r=e.createTexture();return e.bindTexture(e.TEXTURE_2D,r),e.texStorage2D(e.TEXTURE_2D,1,e.RGBA8,t.width,t.height),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),r}function n(){let t=i();const r=e.createFramebuffer();return e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),{texture:t,fbo:r}}function o(t,r){e.activeTexture(t),e.bindTexture(e.TEXTURE_2D,r)}function s(r,i){e.bindFramebuffer(e.READ_FRAMEBUFFER,r),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,i),e.blitFramebuffer(0,0,t.width,t.height,0,0,t.width,t.height,e.COLOR_BUFFER_BIT,e.NEAREST)}function a(t){e.bindFramebuffer(e.DRAW_FRAMEBUFFER,r.source.fbo),e.clearColor(...t),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)}onmessage=async c=>{const l=c.data;l.canvas?function(s){t=s,e=t.getContext("webgl2",{antialias:!1});const c=(t=>{const e=t.createProgram();for(let[r,i]of[[t.VERTEX_SHADER,"#version 300 es\n#define GLSLIFY 1\nout vec2 p;void main(){vec3 v=vec3(-1);v[gl_VertexID]=3.;gl_Position=vec4(p=v.xy,0,1);}"],[t.FRAGMENT_SHADER,"#version 300 es\nprecision highp float;\n#define GLSLIFY 1\nuniform vec4 u_addColor;uniform bool u_isErase;uniform bool u_isImage;uniform bool u_isBrush;uniform sampler2D u_source;uniform sampler2D u_mask;in vec2 p;out vec4 outColor;const int SPECTRAL_SIZE=38;const float SPECTRAL_GAMMA=2.4;const float SPECTRAL_EPSILON=0.0001;float compand(float x,bool inverse){if(inverse){return(x<0.04045)? x/12.92 : pow((x+0.055)/1.055,SPECTRAL_GAMMA);}else{return(x<0.0031308)? x*12.92 : 1.055*pow(x,1.0/SPECTRAL_GAMMA)-0.055;}}vec3 spectral_srgb_to_linear(vec3 srgb){return vec3(compand(srgb.r,true),compand(srgb.g,true),compand(srgb.b,true));}vec3 spectral_linear_to_srgb(vec3 lrgb){return clamp(vec3(compand(lrgb.r,false),compand(lrgb.g,false),compand(lrgb.b,false)),0.0,1.0);}void spectral_upsampling(vec3 lrgb,out float w,out float c,out float m,out float y,out float r,out float g,out float b){w=min(lrgb.r,min(lrgb.g,lrgb.b));lrgb-=w;c=min(lrgb.g,lrgb.b);m=min(lrgb.r,lrgb.b);y=min(lrgb.r,lrgb.g);r=min(max(0.,lrgb.r-lrgb.b),max(0.,lrgb.r-lrgb.g));g=min(max(0.,lrgb.g-lrgb.b),max(0.,lrgb.g-lrgb.r));b=min(max(0.,lrgb.b-lrgb.g),max(0.,lrgb.b-lrgb.r));}void spectral_linear_to_reflectance(vec3 lrgb,inout float R[SPECTRAL_SIZE]){float w,c,m,y,r,g,b;spectral_upsampling(lrgb,w,c,m,y,r,g,b);R[0]=max(SPECTRAL_EPSILON,w+c*0.96853629+m*0.51567122+y*0.02055257+r*0.03147571+g*0.49108579+b*0.97901834);R[1]=max(SPECTRAL_EPSILON,w+c*0.96855103+m*0.54015520+y*0.02059936+r*0.03146636+g*0.46944057+b*0.97901649);R[2]=max(SPECTRAL_EPSILON,w+c*0.96859338+m*0.62645502+y*0.02062723+r*0.03140624+g*0.40165780+b*0.97901118);R[3]=max(SPECTRAL_EPSILON,w+c*0.96877345+m*0.75595012+y*0.02073387+r*0.03119611+g*0.24490420+b*0.97892146);R[4]=max(SPECTRAL_EPSILON,w+c*0.96942204+m*0.92826996+y*0.02114202+r*0.03053888+g*0.06826880+b*0.97858555);R[5]=max(SPECTRAL_EPSILON,w+c*0.97143709+m*0.97223624+y*0.02233154+r*0.02856855+g*0.02732883+b*0.97743705);R[6]=max(SPECTRAL_EPSILON,w+c*0.97541862+m*0.98616174+y*0.02556857+r*0.02459485+g*0.01360600+b*0.97428075);R[7]=max(SPECTRAL_EPSILON,w+c*0.98074186+m*0.98955255+y*0.03330189+r*0.01929520+g*0.01000187+b*0.96663223);R[8]=max(SPECTRAL_EPSILON,w+c*0.98580992+m*0.98676237+y*0.05185294+r*0.01423112+g*0.01284127+b*0.94822893);R[9]=max(SPECTRAL_EPSILON,w+c*0.98971194+m*0.97312575+y*0.10087639+r*0.01033111+g*0.02636635+b*0.89937713);R[10]=max(SPECTRAL_EPSILON,w+c*0.99238027+m*0.91944277+y*0.24000413+r*0.00765876+g*0.07058713+b*0.76070164);R[11]=max(SPECTRAL_EPSILON,w+c*0.99409844+m*0.32564851+y*0.53589066+r*0.00593693+g*0.70421692+b*0.46420440);R[12]=max(SPECTRAL_EPSILON,w+c*0.99517200+m*0.13820628+y*0.79874659+r*0.00485616+g*0.85473994+b*0.20123039);R[13]=max(SPECTRAL_EPSILON,w+c*0.99576545+m*0.05015143+y*0.91186529+r*0.00426186+g*0.95081565+b*0.08808402);R[14]=max(SPECTRAL_EPSILON,w+c*0.99593552+m*0.02912336+y*0.95399623+r*0.00409039+g*0.97170370+b*0.04592894);R[15]=max(SPECTRAL_EPSILON,w+c*0.99564041+m*0.02421691+y*0.97137099+r*0.00438375+g*0.97651888+b*0.02860373);R[16]=max(SPECTRAL_EPSILON,w+c*0.99464769+m*0.02660696+y*0.97939505+r*0.00537525+g*0.97429245+b*0.02060067);R[17]=max(SPECTRAL_EPSILON,w+c*0.99229579+m*0.03407586+y*0.98345207+r*0.00772962+g*0.97012917+b*0.01656701);R[18]=max(SPECTRAL_EPSILON,w+c*0.98638762+m*0.04835936+y*0.98553736+r*0.01366120+g*0.94258630+b*0.01451549);R[19]=max(SPECTRAL_EPSILON,w+c*0.96829712+m*0.00011720+y*0.98648905+r*0.03181352+g*0.99989207+b*0.01357964);R[20]=max(SPECTRAL_EPSILON,w+c*0.89228016+m*0.00008554+y*0.98674535+r*0.10791525+g*0.99989891+b*0.01331243);R[21]=max(SPECTRAL_EPSILON,w+c*0.53740239+m*0.85267882+y*0.98657555+r*0.46249516+g*0.13823139+b*0.01347661);R[22]=max(SPECTRAL_EPSILON,w+c*0.15360445+m*0.93188793+y*0.98611877+r*0.84604333+g*0.06968113+b*0.01387181);R[23]=max(SPECTRAL_EPSILON,w+c*0.05705719+m*0.94810268+y*0.98559942+r*0.94275572+g*0.05628787+b*0.01435472);R[24]=max(SPECTRAL_EPSILON,w+c*0.03126539+m*0.94200977+y*0.98507063+r*0.96860996+g*0.06111561+b*0.01479836);R[25]=max(SPECTRAL_EPSILON,w+c*0.02205445+m*0.91478045+y*0.98460039+r*0.97783966+g*0.08987709+b*0.01515250);R[26]=max(SPECTRAL_EPSILON,w+c*0.01802271+m*0.87065445+y*0.98425301+r*0.98187757+g*0.13656016+b*0.01540513);R[27]=max(SPECTRAL_EPSILON,w+c*0.01613460+m*0.78827548+y*0.98403909+r*0.98377315+g*0.22169624+b*0.01557233);R[28]=max(SPECTRAL_EPSILON,w+c*0.01520947+m*0.65738359+y*0.98388535+r*0.98470202+g*0.32176956+b*0.01565710);R[29]=max(SPECTRAL_EPSILON,w+c*0.01475977+m*0.59909403+y*0.98376116+r*0.98515481+g*0.36157329+b*0.01571025);R[30]=max(SPECTRAL_EPSILON,w+c*0.01454263+m*0.56817268+y*0.98368246+r*0.98537114+g*0.48361920+b*0.01571916);R[31]=max(SPECTRAL_EPSILON,w+c*0.01444459+m*0.54031997+y*0.98365023+r*0.98546685+g*0.46488579+b*0.01572133);R[32]=max(SPECTRAL_EPSILON,w+c*0.01439897+m*0.52110241+y*0.98361309+r*0.98550011+g*0.47440306+b*0.01572502);R[33]=max(SPECTRAL_EPSILON,w+c*0.01437620+m*0.51041094+y*0.98357259+r*0.98551031+g*0.48576990+b*0.01571717);R[34]=max(SPECTRAL_EPSILON,w+c*0.01436343+m*0.50526577+y*0.98353856+r*0.98550741+g*0.49267971+b*0.01571905);R[35]=max(SPECTRAL_EPSILON,w+c*0.01435687+m*0.50255080+y*0.98351247+r*0.98551323+g*0.49625685+b*0.01571059);R[36]=max(SPECTRAL_EPSILON,w+c*0.01435370+m*0.50126452+y*0.98350101+r*0.98551563+g*0.49807754+b*0.01569728);R[37]=max(SPECTRAL_EPSILON,w+c*0.01435408+m*0.50083021+y*0.98350852+r*0.98551547+g*0.49889859+b*0.01570020);}const vec3 XYZ_DATA[SPECTRAL_SIZE]=vec3[](vec3(0.00006469,0.00000184,0.00030502),vec3(0.00021941,0.00000621,0.00103681),vec3(0.00112057,0.00003101,0.00531314),vec3(0.00376661,0.00010475,0.01795439),vec3(0.01188055,0.00035364,0.05707758),vec3(0.02328644,0.00095147,0.11365162),vec3(0.03455942,0.00228226,0.17335873),vec3(0.03722379,0.00420733,0.19620658),vec3(0.03241838,0.00668880,0.18608237),vec3(0.02123321,0.00988840,0.13995048),vec3(0.01049099,0.01524945,0.08917453),vec3(0.00329584,0.02141831,0.04789621),vec3(0.00050704,0.03342293,0.02814563),vec3(0.00094867,0.05131001,0.01613766),vec3(0.00627372,0.07040208,0.00775910),vec3(0.01686462,0.08783871,0.00429615),vec3(0.02868965,0.09424905,0.00200551),vec3(0.04267481,0.09795667,0.00086147),vec3(0.05625475,0.09415219,0.00036904),vec3(0.06947040,0.08678102,0.00019143),vec3(0.08305315,0.07885653,0.00014956),vec3(0.08612610,0.06352670,0.00009231),vec3(0.09046614,0.05374142,0.00006813),vec3(0.08500387,0.04264606,0.00002883),vec3(0.07090667,0.03161735,0.00001577),vec3(0.05062889,0.02088521,0.00000394),vec3(0.03547396,0.01386011,0.00000158),vec3(0.02146821,0.00810264,0.00000000),vec3(0.01251646,0.00463010,0.00000000),vec3(0.00680458,0.00249138,0.00000000),vec3(0.00346457,0.00125930,0.00000000),vec3(0.00149761,0.00054165,0.00000000),vec3(0.00076970,0.00027795,0.00000000),vec3(0.00040737,0.00014711,0.00000000),vec3(0.00016901,0.00006103,0.00000000),vec3(0.00009522,0.00003439,0.00000000),vec3(0.00004903,0.00001771,0.00000000),vec3(0.00002000,0.00000722,0.00000000));vec3 spectral_reflectance_to_xyz(float R[SPECTRAL_SIZE]){vec3 xyz=vec3(0.0);for(int i=0;i<SPECTRAL_SIZE;i++){xyz+=R[i]*XYZ_DATA[i];}return xyz;}float calculate_ks(float r){return pow(1.0-r,2.0)/(2.0*r);}const mat3 XYZ_RGB=mat3(vec3(3.24306333,-1.53837619,-0.49893282),vec3(-0.96896309,1.87542451,0.04154303),vec3(0.05568392,-0.20417438,1.05799454));vec3 spectral_xyz_to_srgb(vec3 xyz){vec3 lrgb=vec3(dot(XYZ_RGB[0],xyz),dot(XYZ_RGB[1],xyz),dot(XYZ_RGB[2],xyz));return spectral_linear_to_srgb(lrgb);}vec3 srgb_to_xyz(vec3 color){vec3 lrgb=spectral_srgb_to_linear(color);float R[SPECTRAL_SIZE];spectral_linear_to_reflectance(lrgb,R);return spectral_reflectance_to_xyz(R);}vec3 spectral_mix(vec3 color1,vec3 color2,float t){vec3 lrgb1=spectral_srgb_to_linear(color1);vec3 lrgb2=spectral_srgb_to_linear(color2);float R1[SPECTRAL_SIZE];float R2[SPECTRAL_SIZE];float R[SPECTRAL_SIZE];spectral_linear_to_reflectance(lrgb1,R1);spectral_linear_to_reflectance(lrgb2,R2);float l1=spectral_reflectance_to_xyz(R1)[1];float l2=spectral_reflectance_to_xyz(R2)[1];float t1=l1*pow(1.0-t,2.0);float t2=l2*pow(t,2.0);t=t2/(t1+t2);for(int i=0;i<SPECTRAL_SIZE;i++){float ks1=calculate_ks(R1[i]);float ks2=calculate_ks(R2[i]);float ks=(1.0-t)*ks1+t*ks2;R[i]=1.0+ks-sqrt(ks*ks+2.0*ks);}return spectral_xyz_to_srgb(spectral_reflectance_to_xyz(R));}const float GAMMA=2.4,EPSILON=0.0001;const float DARKEN_THRESHOLD=0.7;const float EDGE_MIN=0.05,EDGE_MAX=0.35;void main(void){vec2 uv=0.5*p+0.5;vec2 uv1=vec2(uv.x,1.0-uv.y);vec4 source=texture(u_source,uv);vec4 maskColor=texture(u_mask,uv1);if(u_isImage){outColor=maskColor;return;}if(maskColor.r<=0.0){outColor=source;return;}vec4 pigment=vec4(u_addColor.xyz,1.0);if(maskColor.a>DARKEN_THRESHOLD&&!u_isErase){float blacken=0.5*(maskColor.a-DARKEN_THRESHOLD);pigment=pigment*(1.0-blacken)-vec4(0.5)*blacken;}float mixIntensity=maskColor.a;if(!u_isBrush){vec2 texelSize=1.0/vec2(textureSize(u_mask,0));float scaledAlpha=maskColor.a*15.0;float blurEdge=0.0;for(int i=-2;i<=2;i+=2){for(int j=-2;j<=2;j+=2){vec2 sampleUV=uv1+vec2(float(i),float(j))*texelSize;float neighborAlpha=texture(u_mask,sampleUV).a*15.0;blurEdge+=smoothstep(EDGE_MIN,EDGE_MAX,length(vec2(dFdx(neighborAlpha),dFdy(neighborAlpha))));}}blurEdge/=9.0;mixIntensity=clamp(maskColor.a+blurEdge*0.1,0.0,1.0);}outColor=vec4(spectral_mix(source.rgb,pigment.rgb,mixIntensity),1.0);}"]]){const n=t.createShader(r);t.shaderSource(n,i),t.compileShader(n),t.attachShader(e,n)}return t.linkProgram(e),e})(e);e.useProgram(c),["u_addColor","u_isErase","u_isImage","u_isBrush","u_source","u_mask"].forEach((t=>{r[t]=e.getUniformLocation(c,t)})),r.mask=i(),r.source=n(),r.target=n(),e.uniform1i(r.u_source,0),e.uniform1i(r.u_mask,1),o(e.TEXTURE0,r.source.texture),o(e.TEXTURE1,r.mask),a([1,1,1,0])}(l.canvas):l.isBG?a(l.color):l.mask&&function(t){(function(t){let r=t.mask;if(self.navigator&&/Safari/.test(self.navigator.userAgent)&&!/Chrome/.test(self.navigator.userAgent)){const t=new OffscreenCanvas(r.width,r.height);t.getContext("2d").drawImage(r,0,0),r=t.getContext("2d").getImageData(0,0,r.width,r.height)}e.texSubImage2D(e.TEXTURE_2D,0,0,0,e.RGBA,e.UNSIGNED_BYTE,r),t.mask.close()})(t),e.bindFramebuffer(e.FRAMEBUFFER,r.target.fbo),e.uniform1i(r.u_isImage,t.isImage?1:0),e.uniform1i(r.u_isBrush,t.isBrush?1:0),t.isImage||(e.uniform1i(r.u_isImage,!1),e.uniform4f(r.u_addColor,...t.addColor),e.uniform1i(r.u_isErase,!!t.isErase)),e.drawArrays(e.TRIANGLES,0,3),s(r.target.fbo,r.source.fbo),t.isLast&&!t.sp&&s(r.target.fbo,null)}(l)}};Worker.createURL=function(t){const e="function"==typeof t?t.toString():t,r=new Blob(["'use strict';\nself.onmessage="+e],{type:"text/javascript"});return window.URL.createObjectURL(r)},Worker.create=function(t){return new Worker(Worker.createURL(t))};const M={};let T,L,C,k=!1;const N={},O=document.createElement("canvas").getContext("2d");class B{constructor(t,e,r){if(isNaN(t)){this.hex=this.standardize(t);let e=this.hexToRgb(this.hex);this.r=e.r,this.g=e.g,this.b=e.b}else this.r=x(t,0,255),this.g=x(e||t,0,255),this.b=x(r||t,0,255),this.hex=this.rgbToHex(this.r,this.g,this.b);this.gl=[this.r/255,this.g/255,this.b/255,1]}rgbToHex=(t,e,r)=>"#"+(1<<24|t<<16|e<<8|r).toString(16).slice(1);hexToRgb(t){t=t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,((t,e,r,i)=>e+e+r+r+i+i));const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}standardize=t=>(O.fillStyle=t,O.fillStyle)}const F=()=>{X.loaded||((()=>{if(!k)throw new Error("Call `load()` first")})(),X.load())},X={loaded:!1,isBlending:!1,load(){const t=M[T];t.worker||(t.mask=new OffscreenCanvas(L,C),t.glMask=new OffscreenCanvas(L,C),t.ctx=t.mask.getContext("2d"),t.gl=t.glMask.getContext("webgl2"),t.ctx.lineWidth=0,t.offscreen=t.canvas.transferControlToOffscreen(),t.worker=Worker.create(I),t.worker.postMessage(0),t.worker.postMessage({canvas:t.offscreen},[t.offscreen])),Object.assign(this,t)},blend(t=!1,e=!1,r=!1,i=!1){if(F(),!this.isBlending&&t&&(this.currentColor=t.gl,this.isBlending=!0),e||r||t.gl.toString()!==this.currentColor.toString()){const n=r||this.isBrush?this.glMask.transferToImageBitmap():this.mask.transferToImageBitmap();this.worker.postMessage({addColor:this.currentColor,mask:n,isLast:e,isErase:this.isErase,isImage:Boolean(r),sp:i,isBrush:this.isBrush},[n]),this.isErase=this.isBrush=!1,e&&!i?this.isBlending=!1:this.currentColor=t.gl}}};let D=new B("white"),Y=!1;function z(){Y||(F(),H=.01*L,G=-.5*L,W=-.5*C,Z=Math.round(2*L/H),q=Math.round(2*C/H),function(t){V.set(t,{gen:function(t,e){const r=c(.2,.8),i=f(5,10);for(let n=0;n<Z;n++){const o=n;for(let s=0;s<q;s++){const c=f(15,25),l=.5*i*E(r*s*n+c),h=a(o,s);e[n][s]=.2*l*b(t)+h*i*.7}}return e}}),V.get(t).field=V.get(t).gen(0,new Array(Z).fill(null).map((()=>new Float32Array(q))))}("hand"),Y=!0)}class U{constructor(t,e){z(),this.update(t,e),this.plotted=0}update(t,e){this.x=t,this.y=e,this.colIdx=U.getColIndex(t),this.rowIdx=U.getRowIndex(e)}reset(){this.plotted=0}isIn(){return N.field.isActive?U.isIn(this.colIdx,this.rowIdx):this.isInCanvas(this.x,this.y)}isInCanvas(){const t=L,e=C,r=this.x+0,i=this.y+0;return r>=-.3*t&&r<=1.3*t&&i>=-.3*e&&i<=1.3*e}angle(){return this.isIn()&&N.field.isActive?V.get(N.field.current).field[this.colIdx][this.rowIdx]*N.field.wiggle:0}moveTo(t,e,r=1){this.movePos(t,e,r)}plotTo(t,e,r,i=1){this.movePos(t,e,r,i)}movePos(t,e,r,i=!1){const n=i||1;if(this.isIn())for(let o=0;o<e/r;o++){const e=this.angle()-(i?t.angle(this.plotted):t);this.update(this.x+r*b(e),this.y+r*E(e)),this.plotted+=r/n}else this.plotted+=r/n}static getRowIndex(t,e=1){const r=t+0-W;return Math.round(r/H/e)}static getColIndex(t,e=1){const r=t+0-G;return Math.round(r/H/e)}static isIn(t,e){return t>=0&&e>=0&&t<Z&&e<q}}N.field={isActive:!1,current:null,wiggle:1};let H,G,W,Z,q,V=new Map;function $(t=1){(function(t){if(N.field.wiggle||(N.field.wiggle=1),z(),!V.has(t))throw new Error(`Field "${name}" does not exist.`);N.field.isActive=!0,N.field.current=t})("hand"),N.field.wiggle=t}function j(t){X.ctx.beginPath(),t.forEach(((t,e)=>{0===e?X.ctx.moveTo(t.x,t.y):X.ctx.lineTo(t.x,t.y)})),X.ctx.closePath()}function K(t,e,r){const i=2*Math.PI,n=r/2;X.ctx.moveTo(t+n,e),X.ctx.arc(t,e,n,0,i)}const J={isActive:!1,c:null,a:255};function Q(t=_bg_Color,e=255){J.isActive=!0,J.c=new B(t),J.a=e}function tt(){J.isActive=!1}function et(t){X.blend(J.c),X.isErase=!0,X.ctx.save(),X.ctx.fillStyle="rgb(255 0 0 / "+J.a+"%)",j(t),X.ctx.fill(),X.ctx.restore()}class rt{constructor(t,e=!1){this.a=t,this.vertices=e?t:t.map((([t,e])=>({x:t,y:e}))),this.sides=this.vertices.map(((t,e,r)=>[t,r[(e+1)%r.length]])),this._intersectionCache={}}intersect(t){const e=`${t.point1.x},${t.point1.y}-${t.point2.x},${t.point2.y}`;if(this._intersectionCache[e])return this._intersectionCache[e];const r=[];for(const[e,i]of this.sides){const n=P(t.point1,t.point2,e,i);n&&r.push(n)}return this._intersectionCache[e]=r,r}erase(){et(this.vertices)}show(){J.isActive?this.erase():(N.draw&&this.draw(),N.hatch&&this.hatch(),N.fill&&this.fill())}}class it{constructor(t){this.segments=[],this.angles=[],this.pres=[],this.type=t,this.dir=0,this.calcIndex(0),this.pol=!1}addSegment(t=0,e=0,r=1,i=!1){this.angles.length>0&&this.angles.pop(),t=i?(t%360+360)%360:w(t),this.angles.push(t,t),this.pres.push(r),this.segments.push(e),this.length=this.segments.reduce(((t,e)=>t+e),0)}endPlot(t=0,e=1,r=!1){t=r?(t%360+360)%360:w(t),this.angles[this.angles.length-1]=t,this.pres.push(e)}rotate(t){this.dir=w(t)}pressure(t){return t>this.length?this.pres[this.pres.length-1]:this.curving(this.pres,t)}angle(t){return t>this.length?this.angles[this.angles.length-1]:(this.calcIndex(t),"curve"===this.type?this.curving(this.angles,t)+this.dir:this.angles[this.index]+this.dir)}curving(t,e){let r=t[this.index],i=t[this.index+1]??r;return Math.abs(i-r)>180&&(i>r?i=-(360-i):r=-(360-r)),m(e-this.suma,0,this.segments[this.index],r,i,!0)}calcIndex(t){this.index=-1,this.suma=0;let e=0;for(;e<=t;)this.suma=e,e+=this.segments[this.index+1],this.index++;return this.index}genPol(t,e,r=1,i){z();const n=.5,o=[],s=Math.round(this.length/n),a=new U(t,e);let l=0,h=0;for(let t=0;t<s;t++){a.plotTo(this,n,n);const t=this.calcIndex(a.plotted);l+=n,(l>=Math.max(this.segments[t]*i*c(.7,1.3),10)||t>=h)&&a.x&&(o.push([a.x,a.y]),l=0,t>=h&&h++)}return new rt(o)}erase(t,e,r){this.origin&&([t,e,r]=[...this.origin,1]),this.pol=this.genPol(t,e,r,.15),et(this.pol.vertices)}show(t,e,r=1){J.isActive?this.erase():(N.stroke&&this.draw(t,e,r),N.hatch&&this.hatch(t,e,r),N.fill&&this.fill(t,e,r))}}let nt,ot,st;class at{constructor(){this.isClosed=!1,this.curvature=st,this.vert=[]}vertex(t,e,r){this.vert.push([t,e,r])}show(){mt(this.vert,this.curvature,this.isClosed).show()}}function ct(t=0){st=x(t,0,1),nt=[]}function lt(t,e,r=1){ot=new at,nt.push(ot),ot.vertex(t,e,r)}function ht(t,e,r=1){ot.vertex(t,e,r)}function ft(){ot.vertex(...ot.vert[0]),ot.isClosed=!0}function ut(){for(let t of nt)t.show();nt=!1}function gt(t,e=.5){mt(t,e).show()}function mt(t,e=.5,r=!1){const i=new it(0===e?"segments":"curve"),n=2*Math.PI;if(r&&0!==e&&t.push(t[1]),t&&t.length>0){let o,s,a,c=0;for(let l=0;l<t.length-1;l++)if(e>0&&l<t.length-2){const h=t[l],f=t[l+1],u=t[l+2],g=S(h[0],h[1],f[0],f[1]),m=S(f[0],f[1],u[0],u[1]),x=A(h[0],h[1],f[0],f[1]),d=A(f[0],f[1],u[0],u[1]),p=e*Math.min(g,m,.5*Math.min(g,m)),y=Math.max(g,m),v=g-p,_=m-p;if(Math.floor(x)===Math.floor(d)){const e=r&&0===l?0:g-c,n=r?0===l?0:m-a:m;i.addSegment(x,e,h[2],!0),l===t.length-3&&i.addSegment(d,n,f[2],!0),c=0,0===l&&(o=g,a=p,s=t[1],c=0)}else{const e={x:f[0]-p*b(-x),y:f[1]-p*E(-x)},u={x:e.x+y*b(90-x),y:e.y+y*E(90-x)},g={x:f[0]+p*b(-d),y:f[1]+p*E(-d)},m={x:g.x+y*b(90-d),y:g.y+y*E(90-d)},w=P(e,u,g,m,!0),R=S(e.x,e.y,w.x,w.y),A=S(e.x,e.y,g.x,g.y)/2,I=n*R*(2*Math.asin(A/R)*(180/Math.PI))/360,M=r&&0===l?0:v-c,T=l===t.length-3?r?o-p:_:0;i.addSegment(x,M,h[2],!0),i.addSegment(x,isNaN(I)?0:I,h[2],!0),i.addSegment(d,T,f[2],!0),c=p,0===l&&(o=v,a=p,s=[e.x,e.y])}l===t.length-3&&i.endPlot(d,f[2],!0)}else if(0===e){const e=t[l],r=t[l+1],n=S(e[0],e[1],r[0],r[1]),o=A(e[0],e[1],r[0],r[1]);i.addSegment(o,n,r[2],!0),l===t.length-2&&i.endPlot(o,1,!0)}i.origin=r&&0!==e?s:t[0]}return i}let xt,dt=0,pt=!1,yt=30,vt=t=>(t&&(yt=t),yt);function _t(t){pt&&(t>dt+1e3/vt()||0===t)&&(dt=t,xt&&xt(),bt()),requestAnimationFrame(_t)}function bt(){X.blend(!1,!0)}let Et,wt,Rt=!1;const St={},At={},Pt=[];function It(){if(!Rt){F(),Et=X.gl,wt=new Float32Array([2/L,0,0,0,0,-2/C,0,0,0,0,1,0,-1,1,0,1]);const t=(t=>{const e=t.createProgram();for(let[r,i]of[[t.VERTEX_SHADER,"#version 300 es\nin vec2 a_position;in float a_radius,a_alpha;uniform mat4 u_matrix;out float v_alpha;void main(){gl_Position=u_matrix*vec4(a_position,0,1);v_alpha=a_alpha;gl_PointSize=a_radius*2.;}"],[t.FRAGMENT_SHADER,"#version 300 es\nprecision highp float;in float v_alpha;out vec4 outColor;void main(){vec2 v=gl_PointCoord-vec2(.5);float f=length(v),a=fwidth(f);f=1.-smoothstep(.5-a,.5+a,f);if(f<.01)discard;outColor=vec4(vec3(1,0,0)*v_alpha,v_alpha*f);}\n"]]){const n=t.createShader(r);t.shaderSource(n,i),t.compileShader(n),t.attachShader(e,n)}return t.linkProgram(e),e})(Et);Et.useProgram(t),Et.enable(Et.BLEND),Et.blendFunc(Et.ONE_MINUS_DST_ALPHA,Et.ONE),["a_position","a_radius","a_alpha"].forEach((e=>St[e]=Et.getAttribLocation(t,e))),["u_matrix"].forEach((e=>At[e]=Et.getUniformLocation(t,e))),Rt=!0}}function Mt(t,e,r,i){It(),Pt.push({x:t+0,y:e+0,radius:r/2,alpha:i/100})}function Tt(){if(0===Pt.length)return;const t=new Float32Array(4*Pt.length);Pt.forEach(((e,r)=>{const i=4*r;t.set([e.x,e.y,e.radius,e.alpha],i)})),Pt.length=0;const e=Et.createVertexArray();Et.bindVertexArray(e);const r=Et.createBuffer();Et.bindBuffer(Et.ARRAY_BUFFER,r),Et.bufferData(Et.ARRAY_BUFFER,t,Et.STATIC_DRAW),Et.enableVertexAttribArray(St.a_position),Et.vertexAttribPointer(St.a_position,2,Et.FLOAT,!1,16,0),Et.enableVertexAttribArray(St.a_radius),Et.vertexAttribPointer(St.a_radius,1,Et.FLOAT,!1,16,8),Et.enableVertexAttribArray(St.a_alpha),Et.vertexAttribPointer(St.a_alpha,1,Et.FLOAT,!1,16,12),Et.uniformMatrix4fv(At.u_matrix,!1,wt),Et.drawArrays(Et.POINTS,0,t.length/4),Et.bindVertexArray(null),Et.deleteBuffer(r),Et.deleteVertexArray(e)}const Lt=2*Math.PI;N.stroke={color:new B("black"),weight:1,clipWindow:null,type:"HB",isActive:!1,opacity:1};let Ct,kt,Nt,Ot,Bt=new Map;function Ft(){return{...N.stroke}}function Xt(t){N.stroke={...t}}function Dt(t,e){e.type=["marker","custom","image","spray"].includes(e.type)?e.type:"default",Bt.set(t,{param:e,colors:[],buffers:[]})}function Yt(t,e,r=1){(function(t){Bt.has(t)&&(N.stroke.type=t)})(t),function(t,e,r){N.stroke.color=new B(...arguments),N.stroke.isActive=!0}(e),function(t){N.stroke.weight=t}(r)}function zt(){N.stroke.isActive=!1}const Ut={};function Ht(t,e,r,i=!1){Ct=new U(t,e),kt=r,Nt=i,Nt&&Nt.calcIndex(0)}const Gt=[];function Wt(t,e){e||(Ot=t),function(){Ut.seed=99999*c();const{param:t}=Bt.get(N.stroke.type)??{};if(!t)return;Ut.p=t;const{pressure:e}=t;Ut.a="custom"!==e.type?c(-1,1):0,Ut.b="custom"!==e.type?c(1,1.5):0,Ut.cp="custom"!==e.type?c(3,3.5):c(-.2,.2),[Ut.min,Ut.max]=e.min_max,It(),Kt()&&X.blend(N.stroke.color),X.isBrush=!0,Ut.alpha=jt(),Qt()}();const r=function(){const{param:t}=Bt.get(N.stroke.type)??{};return t?t.spacing:1}(),i=Math.round(kt*(e?t:1)/r);for(let n=0;n<i;n++)Gt.length<2*i&&Gt.push(u()),Zt(),e?Ct.plotTo(Nt,r,r,t,n<10):Ct.moveTo(t,r,r);Tt(N.stroke.color),Qt()}function Zt(t=!1){if(!Kt())return;let e=t||qt();switch(Ut.p.type){case"spray":!function(t){const e=N.stroke.weight*Ut.p.vibration*t+N.stroke.weight*l(Gt)*Ut.p.vibration/3,r=Ut.p.weight*c(.9,1.1),i=Math.ceil(Ut.p.quality/t);for(let t=0;t<i;t++){const t=c(.9,1.1),i=t*e*c(-1,1),n=c(-1,1),o=Math.sqrt((t*e)**2-i**2);Mt(Ct.x+i,Ct.y+n*o,r,Ut.alpha)}}(e);break;case"marker":Jt(e);break;case"custom":case"image":!function(t,e,r=!0){X.ctx.save();const i=r?N.stroke.weight*Ut.p.vibration:0,n=r?i*c(-1,1):0,o=r?i*c(-1,1):0;X.ctx.translate(Ct.x+n,Ct.y+o),function(t){X.ctx.scale(t,t);let e=0;"random"===Ut.p.rotate?e=f(0,Lt):"natural"===Ut.p.rotate&&(e=(Nt?-Nt.angle(Ct.plotted):-Ot)+Ct.angle(),e=e*Math.PI/180),X.ctx.rotate(e)}(N.stroke.weight*t),Ut.p.tip(X.ctx),X.ctx.restore()}(e);break;default:!function(t,e=1){const r=(e=m(e,0,1,.9,1.05))*N.stroke.weight*Ut.p.vibration*(Ut.p.definition+(1-Ut.p.definition)*l(Gt)*$t(.5,.9,5,.2,1.2)/t);c(0,Ut.p.quality*t)>.4&&Mt(Ct.x+.7*r*c(-1,1),Ct.y+r*c(-1,1),t*Ut.p.weight*c(.85,1.15)*N.stroke.weight,Ut.alpha)}(e)}}function qt(){return Nt?Vt()*Nt.pressure(Ct.plotted):Vt()}function Vt(){return"custom"===Ut.p.pressure.type?m(Ut.p.pressure.curve(Ct.plotted/kt)+Ut.cp,0,1,Ut.min,Ut.max,!0):$t()}function $t(t=.5+Ut.p.pressure.curve[0]*Ut.a,e=1-Ut.p.pressure.curve[1]*Ut.b,r=Ut.cp,i=Ut.min,n=Ut.max){return m(1/(1+Math.pow(Math.abs((Ct.plotted-t*kt)/(e*kt/2)),2*r)),0,1,i,n)}function jt(){return["default","spray"].includes(Ut.p.type)?Ut.p.opacity*N.stroke.opacity:Ut.p.opacity/N.stroke.weight*N.stroke.opacity}function Kt(){if(N.stroke.clipWindow)return Ct.x>=N.stroke.clipWindow[0]&&Ct.x<=N.stroke.clipWindow[2]&&Ct.y>=N.stroke.clipWindow[1]&&Ct.y<=N.stroke.clipWindow[3];{let t=L,e=C,r=.05*L,i=Ct.x+0,n=Ct.y+0;return i>=-r&&i<=t+r&&n>=-r&&n<=e+r}}function Jt(t,e=!0,r=Ut.alpha){const i=e?N.stroke.weight*Ut.p.vibration:0,n=e?i*c(-1,1):0,o=e?i*c(-1,1):0;Mt(Ct.x+n,Ct.y+o,N.stroke.weight*Ut.p.weight*t,r)}function Qt(){if(Kt()){let t=qt(),e=jt();if("marker"===Ut.p.type){for(let r=1;r<10;r++)Jt(t*r/10,!1,5*e);Tt(N.stroke.color)}else if("custom"===Ut.p.type||"image"===Ut.p.type)for(let r=1;r<5;r++)X.ctx.beginPath(),Ut.drawCustomOrImage(t*r/5,e,!1),X.ctx.fill()}}function te(t,e,r,i){z();let n=S(t,e,r,i);0!=n&&(Ht(t,e,n),Wt(A(t,e,r,i),!1))}const ee=["weight","vibration","definition","quality","opacity","spacing","pressure","type","tip","rotate"],re=[["pen",[.35,.12,.5,8,88,.3,{curve:[.15,.2],min_max:[1.4,.9]}]],["rotring",[.2,.05,.5,30,115,.15,{curve:[.35,.2],min_max:[1.3,.9]}]],["2B",[.25,.7,.45,28,140,.1,{curve:[.15,.2],min_max:[1.3,1]}]],["HB",[.3,.5,.4,4,130,.2,{curve:[.15,.2],min_max:[1.2,.9]}]],["2H",[.2,.4,.3,2,60,.2,{curve:[.15,.2],min_max:[1.2,.9]}]],["cpencil",[.3,.55,.8,7,40,.1,{curve:[.15,.2],min_max:[.95,1.2]}]],["charcoal",[.3,1.3,.8,500,80,.03,{curve:[.15,.2],min_max:[1.5,.9]}]],["spray",[.15,6,15,40,85,.65,{curve:[0,.1],min_max:[.5,1]},"spray"]],["marker",[2.5,.12,null,null,.4,.04,{curve:[.35,.25],min_max:[1.5,1]},"marker"]]];for(let t of re){let e={};for(let r=0;r<t[1].length;r++)e[ee[r]]=t[1][r];Dt(t[0],e)}function ie(){return{...N.hatch}}function ne(t=5,e=45,r={rand:!1,continuous:!1,gradient:!1}){let i=N.hatch;i.isActive=!0,i.dist=t,i.angle=e,i.options=r}function oe(t,e="black",r=1){N.hatch.hBrush={brush:t,color:e,weight:r}}function se(){N.hatch.isActive=!1,N.hatch.hBrush=!1}function ae(t){if(t._boundingBox)return t._boundingBox;let e=Infinity,r=Infinity,i=-Infinity,n=-Infinity;for(let o=0;o<t.a.length;o++){const[s,a]=t.a[o];s<e&&(e=s),s>i&&(i=s),a<r&&(r=a),a>n&&(n=a)}return t._boundingBox={minX:e,minY:r,maxX:i,maxY:n},t._boundingBox}rt.prototype.draw=function(t=!1,e,r){let i=Ft();if(t&&Yt(t,e,r),i.isActive)for(let t of this.sides)te(t[0].x,t[0].y,t[1].x,t[1].y);Xt(i)},it.prototype.draw=function(t,e,r){Ft().isActive&&(this.origin&&(t=this.origin[0],e=this.origin[1],r=1),function(t,e,r,i){z(),Ht(e,r,t.length,t),Wt(i,!0)}(this,t,e,r))},N.hatch={isActive:!1,dist:5,angle:45,options:{},hBrush:!1},rt.prototype.hatch=function(t=!1,e,r){let i=ie();t&&ne(t,e,r),i.isActive&&function(t){let e=N.hatch.dist,r=w(N.hatch.angle)%180,i=N.hatch.options,n=Ft();N.hatch.hBrush&&Yt(...Object.values(N.hatch.hBrush)),Array.isArray(t)||(t=[t]);const o=function(t){let e={minX:Infinity,minY:Infinity,maxX:-Infinity,maxY:-Infinity};for(let r of t){const t=ae(r);e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY)}return e}(t);let s=new rt([[o.minX,o.minY],[o.maxX,o.minY],[o.maxX,o.maxY],[o.minX,o.maxY]]),a=r<=90&&r>=0?o.minY:o.maxY,l=i.gradient?m(i.gradient,0,1,1,1.1,!0):1,h=[],f=0,u=e,g=t=>({point1:{x:o.minX+u*t*b(90-r),y:a+u*t*E(90-r)},point2:{x:o.minX+u*t*b(90-r)+b(-r),y:a+u*t*E(90-r)+E(-r)}});for(;s.intersect(g(f)).length>0;){let e=[];for(let r of t)e.push(r.intersect(g(f)));h[f]=e.flat().sort(((t,e)=>t.x===e.x?t.y-e.y:t.x-e.x)),u*=l,f++}let x=h.filter((t=>void 0!==t[0])),d=i.rand||0;for(let t=0;t<x.length;t++){let r=x[t],n=t>0&&i.continuous;for(let i=0;i<r.length-1;i+=2)0!==d&&(r[i].x+=d*e*c(-10,10),r[i].y+=d*e*c(-10,10),r[i+1].x+=d*e*c(-10,10),r[i+1].y+=d*e*c(-10,10)),te(r[i].x,r[i].y,r[i+1].x,r[i+1].y),n&&te(x[t-1][1].x,x[t-1][1].y,r[i].x,r[i].y)}Xt(n)}(this),function(t){N.hatch={...t}}(i)},it.prototype.hatch=function(t,e,r){ie().isActive&&(this.origin&&(t=this.origin[0],e=this.origin[1],r=1),this.pol=this.genPol(t,e,r,.25),this.pol.hatch())},N.fill={color:new B("#002185"),opacity:60,bleed_strength:.07,texture_strength:.8,border_strength:.5,direction:"out",isActive:!1};const ce=()=>({...N.fill});function le(t,e,r,i){N.fill.opacity=(arguments.length<4?e:i)||60,N.fill.color=arguments.length<3?new B(t):new B(t,e,r),N.fill.isActive=!0}function he(t,e="out"){N.fill.bleed_strength=x(t,0,1),N.fill.direction=e}function fe(t=.4,e=.4){N.fill.texture_strength=x(t,0,1),N.fill.border_strength=x(e,0,1)}function ue(){N.fill.isActive=!1}let ge;const me=[[],[]];class xe{constructor(t,e,r,i=[],n=!1,o,s){if(this.v=t,this.m=e,this.dir=i,this.midP=r,n){let e=0,i=0;const n=[];for(let o=0;o<t.length;o++){const s=Math.abs(r.x-t[o].x),a=Math.abs(r.y-t[o].y);e=Math.max(e,s),i=Math.max(i,a);const c=t[o],l=t[(o+1)%t.length],h={x:l.x-c.x,y:l.y-c.y},f=R(0,0,h.x,h.y,90),u={x:c.x+h.x/2,y:c.y+h.y/2};n.push({v1:c,v2:l,ray:{point1:u,point2:{x:u.x+f.x,y:u.y+f.y}}})}this.sizeX=e,this.sizeY=i,this.dir=Array(t.length),n.forEach(((t,e)=>{let r=0;for(const e of ge.intersect(t.ray))i=t.v1,o=e,((n=t.v2).x-i.x)*(o.y-i.y)-(n.y-i.y)*(o.x-i.x)>.01&&r++;var i,n,o;this.dir[e]=r%2==0}));const o=c(-.6,.6)*e,s=c(-.6,.6)*i;this.midP={x:r.x+o,y:r.y+s}}else this.sizeX=o,this.sizeY=s}trim(t=1){if(t>=1||t<0||this.v.length<=8)return{v:[...this.v],m:[...this.m],dir:[...this.dir]};const e=~~((1-t)*this.v.length),r=~~(this.v.length/2-e/2),i=[...this.v],n=[...this.m],o=[...this.dir];return i.splice(r,e),n.splice(r,e),o.splice(r,e),{v:i,m:n,dir:o}}grow(t=1){const{v:e,m:r,dir:i}=this.trim(t),n=e.length,o=[],s=[],a=[],h="out"===N.fill.direction?-90:90;let f=0,g=999===t?c(.6,.8):N.fill.bleed_strength;for(let m=0;m<n;m++){me[0].length<1.5*n&&(me[0].push(u(.5,.2)),me[1].push(u(0,.02)));const x=e[m],d=m+1<n?e[m+1]:e[0];t<997&&(g=r[m]);const p=(i[m]?h:-h)+5*c(-1,1),y=d.x-x.x,v=d.y-x.y,{x:_,y:b}=R(0,0,y,v,p),E=.5,w=l(me[0])*c(.65,1.35)*g;o[f]=x,s[f]=r[m],a[f++]=i[m],o[f]={x:x.x+y*E+_*w,y:x.y+v*E+b*w},s[f]=r[m]+l(me[1]),a[f++]=i[m]}return new xe(o,s,this.midP,a,!1,this.sizeX,this.sizeY)}fill(t,e,r){const i=3*r,n=2*e*(1+r/2);X.blend(t),X.ctx.save(),X.ctx.strokeStyle=`rgb(255 0 0 / ${.01*N.fill.border_strength})`,X.ctx.lineCap="round";const o=Math.max(this.sizeX,this.sizeY),s=c(.15,.7);let a,l=this.grow();for(let r=0;r<20;r++){r%4==0&&(l=l.grow()),r%2==0&&(a=[l.grow(1-.0125*r),l.grow(.7-.0125*r),l.grow(.4-.0125*r)]);for(const t of a)t.grow(999).grow(997).layer(r,o,n);r%2==0&&l.grow(s).grow(999).layer(r,o,2*n),r%5!=0&&19!==r||(0!==i&&l.erase(3*i,e),X.blend(t,!0,!1,!0))}X.ctx.restore()}layer(t,e,r){X.ctx.lineWidth=m(t,0,24,e/25,e/30,!0),X.ctx.fillStyle=`rgb(255 0 0 / ${r}%)`,j(this.v),X.ctx.fill(),X.ctx.stroke()}erase(t,e){X.ctx.save();const r=~~(c(80,110)*m(t,0,1,2,3.5)),i=this.sizeX/1.3,n=this.sizeY/1.3,o=Math.min(this.sizeX,this.sizeY)*(1.4-N.fill.bleed_strength),s=.05*o,a=.4*o,{x:l,y:h}=this.midP;X.ctx.globalCompositeOperation="destination-out";const f=(5-m(e,80,100,.3,.7,!0))*t/255;X.ctx.fillStyle=`rgb(255 0 0 / ${f})`,X.ctx.lineWidth=0;for(let t=0;t<r;t++){const e=l+u(0,i),r=h+u(0,n),o=c(s,a);X.ctx.beginPath(),K(e,r,o),t%5!=0&&X.ctx.fill()}X.ctx.globalCompositeOperation="source-over",X.ctx.restore()}}rt.prototype.fill=function(t=!1,e,r,i,n,o){let s=ce();t&&(le(t,e),he(r,o),fe(i,n)),s.isActive&&(z(),function(t){ge=t;const e=[...t.vertices],r=~~(.25*e.length*g({1:5,2:10,3:60})),i=N.fill.bleed_strength,n=e.map(((t,e)=>(e>r?1:.3)*c(.85,1.2)*i)),o=f(0,e.length),s=[...e.slice(o),...e.slice(0,o)],a=function(t){if(t.length<8)return t.reduce(((t,e)=>({x:t.x+e.x,y:t.y+e.y})),{x:0,y:0}).map((e=>e/t.length));const e=[...t];e[0].x===e[e.length-1].x&&e[0].y===e[e.length-1].y||e.push(e[0]);let r=0,i=0,n=0;for(let t=0;t<e.length-1;t++){const o=e[t].x*e[t+1].y-e[t+1].x*e[t].y;r+=o,i+=(e[t].x+e[t+1].x)*o,n+=(e[t].y+e[t+1].y)*o}return r*=.5,r?{x:i/(6*r),y:n/(6*r)}:{x:e[0].x,y:e[0].y}}(s);new xe(s,n,a,[],!0).fill(N.fill.color,m(N.fill.opacity,0,100,0,1,!0),N.fill.texture_strength)}(this)),(t=>{N.fill={...t}})(s)},it.prototype.fill=function(t,e,r){ce().isActive&&(this.origin&&(t=this.origin[0],e=this.origin[1],r=1),this.pol=this.genPol(t,e,r,m(N.fill.bleed_strength,0,.6,.3,.45,!0)),this.pol.fill())};const de=Math.min(window.devicePixelRatio||1,2);let pe=Math.floor(window.innerWidth*de),ye=Math.floor(window.innerHeight*de);const ve=Math.max(pe,ye);if(ve<1800){const t=1800/ve;pe=Math.floor(pe*t),ye=Math.floor(ye*t)}!function(t,e){const r=document.createElement("canvas");r.width=t,r.height=e,document.getElementsByTagName("body")[0].appendChild(r),r.style.maxWidth="100%",r.style.maxHeight="100%",r.style.width="auto",r.style.height="auto",r.style.objectFit="contain",((t,e)=>{T=t,M[T]||(M[T]={canvas:e}),L=e.width,C=e.height,k=!0,X.load()})(r.id,r)}(pe,ye);const _e=Math.min(pe,ye)/3e3;!function(t){for(const{param:e}of Bt.values())e&&(e.weight*=t,e.vibration*=t,e.spacing*=t)}(10*_e);const be=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)||navigator.maxTouchPoints>1,Ee=["#ac443a","#dba3af","#744438","#b8a136","#428f70","#81868b","#3957a5","#dbb07f","#74393b","#7aa7cb","#45423e","#c45e3a","#313d6b","#f2bb1d"],we=["HB","HB","2B","cpencil","cpencil","charcoal"],Re=h(["#fdfdf8","#fffef0","#fff8ec","#fff1ce","#fffceb","#f5f0e8","#f0f5f2","#eef3f7","#f8f0ed"]),Se=[1,1.5,1.5,1,1.2],Ae=[.95,1.2,2.5,1.65,1.2],Pe=be?1.5:1,Ie=[.3*Pe,.95*Pe],Me=[.25*Pe,.6*Pe],Te=[.27*Pe,.65*Pe],Le=[.05*Pe,.17*Pe],Ce=[.5,.7],ke=[.15,.35],Ne=[.06,.13],Oe=[.07,.15],Be=[[1319,636],[1300,647],[1277,660],[1249,671],[1222,683],[1190,692],[1165,702],[1140,711],[1117,718],[1089,725],[1062,734],[1039,741],[1014,748],[986,755],[963,762],[938,768],[902,773],[871,776],[843,779],[814,782],[782,783],[751,786],[719,787],[694,789],[669,784],[644,779],[620,770],[595,759],[572,751],[549,739],[528,727],[509,714],[488,697],[471,682],[454,667],[444,651],[433,634],[425,618],[414,602],[404,583],[400,564],[391,546],[385,527],[383,504],[381,487],[383,471],[383,452],[383,436],[383,419],[381,402],[376,385],[370,367],[366,350],[364,333],[366,315],[368,298],[381,282],[404,275],[431,275],[454,282],[475,291],[494,303],[513,318],[530,331],[549,342],[568,353],[589,363],[612,371],[637,378],[662,385],[688,389],[715,391],[740,391],[766,385],[787,375],[808,366],[824,353],[833,335],[839,318],[848,300],[852,279],[860,258],[869,235],[873,217],[875,200],[877,183],[879,165],[881,147],[885,130],[900,115],[917,102],[942,101],[955,116],[957,133],[957,150],[963,167],[980,179],[991,164],[993,147],[991,129],[1001,113],[1016,99],[1041,94],[1070,101],[1081,116],[1081,133],[1081,150],[1085,167],[1110,171],[1125,157],[1129,140],[1123,123],[1125,106],[1140,92],[1167,83],[1192,85],[1205,101],[1205,118],[1205,134],[1205,153],[1205,174],[1209,195],[1209,211],[1213,232],[1213,251],[1213,269],[1213,289],[1216,307],[1216,324],[1216,340],[1216,359],[1216,375],[1216,392],[1218,409],[1218,427],[1218,445],[1220,462],[1232,479],[1258,480],[1283,480],[1310,476],[1338,471],[1363,464],[1386,455],[1409,448],[1430,437],[1453,430],[1476,420],[1499,412],[1529,409],[1554,409],[1581,412],[1607,417],[1632,423],[1659,429],[1682,436],[1706,445],[1729,455],[1750,466],[1767,479],[1783,492],[1796,507],[1800,525],[1783,541],[1760,548],[1735,550],[1710,552],[1685,550],[1659,550],[1634,550],[1605,550],[1579,550],[1554,553],[1529,559],[1506,566],[1481,574],[1455,580],[1432,587],[1409,597],[1388,606],[1365,615],[1342,623],[1321,633]],Fe=[[1864,488],[1838,500],[1810,509],[1781,519],[1755,531],[1729,543],[1703,557],[1677,569],[1648,582],[1619,594],[1591,606],[1559,616],[1531,627],[1499,639],[1468,649],[1439,658],[1411,668],[1382,677],[1351,686],[1317,694],[1286,701],[1254,707],[1220,714],[1189,720],[1158,726],[1126,731],[1090,740],[1056,745],[1025,748],[991,752],[957,755],[923,759],[892,766],[855,771],[824,776],[790,780],[759,780],[725,780],[694,780],[662,771],[636,755],[615,726],[597,700],[574,660],[561,637],[548,611],[535,587],[524,561],[514,538],[506,516],[493,488],[475,450],[454,408],[433,368],[420,333],[407,306],[396,283],[383,262],[375,241],[362,220],[349,201],[378,212],[407,222],[435,234],[464,243],[493,252],[522,260],[550,269],[581,278],[613,285],[641,293],[670,302],[699,311],[730,319],[759,328],[787,340],[803,321],[821,302],[845,281],[866,262],[889,241],[910,222],[931,203],[954,186],[973,168],[986,188],[986,208],[986,231],[988,252],[991,273],[999,293],[1012,274],[1022,252],[1040,234],[1064,210],[1077,191],[1080,215],[1080,236],[1080,260],[1085,285],[1090,307],[1113,293],[1124,271],[1140,250],[1150,229],[1163,205],[1173,184],[1181,205],[1186,226],[1197,248],[1202,269],[1210,295],[1215,316],[1220,337],[1228,359],[1231,380],[1236,401],[1239,422],[1244,443],[1249,464],[1254,484],[1278,470],[1304,458],[1335,446],[1372,432],[1400,420],[1432,408],[1458,396],[1484,384],[1518,385],[1549,396],[1578,405],[1606,413],[1635,422],[1666,431],[1695,441],[1724,453],[1752,465],[1781,476],[1812,483],[1836,497]],Xe=[[429,525],[454,521],[479,514],[505,507],[530,501],[555,493],[583,486],[606,479],[635,472],[660,468],[686,462],[715,459],[740,455],[766,450],[791,447],[816,444],[843,443],[871,440],[896,438],[921,438],[946,438],[976,440],[1001,443],[1026,444],[1052,447],[1077,450],[1102,452],[1127,455],[1152,458],[1178,462],[1205,466],[1230,471]],De=[[1039,732],[1014,738],[988,742],[963,745],[938,748],[913,742],[885,731],[866,718],[852,704],[839,689],[831,672],[829,655],[831,636],[835,619],[845,602],[860,587],[881,577],[904,569],[927,560],[951,553],[976,548],[1001,543],[1026,541],[1052,541],[1077,541],[1102,543],[1127,549],[1150,556],[1174,564],[1192,576],[1188,559],[1190,542],[1190,525],[1190,508],[1190,486],[1195,469],[1199,452],[1201,436],[1201,419],[1203,402],[1205,385],[1205,364],[1207,346]],Ye=[[753,779],[749,762],[749,745],[744,728],[744,711],[744,695],[744,678],[742,661],[740,643],[740,625],[738,606],[738,590],[740,573],[740,556],[715,553],[688,555],[658,555],[633,555],[606,555],[580,555],[555,555],[530,555],[503,555],[477,555],[452,559],[479,557],[513,556],[538,553],[570,552],[595,550],[620,550],[646,549],[675,549],[702,548],[728,546],[753,545],[778,542],[805,541],[831,538],[856,536],[881,534],[911,534],[936,532],[961,531],[986,529],[1012,527],[1039,525],[1064,522]],ze=[[1529,541],[1518,525],[1514,507],[1516,490],[1523,473],[1552,475],[1577,480],[1600,489],[1624,496],[1640,508],[1632,525],[1607,528],[1579,531],[1554,534]],Ue=[[877,235],[904,231],[930,228],[955,227]],He=[[1066,223],[1091,221],[1117,218],[1142,217]],Ge=[[980,297],[1016,297],[1047,297]],We=[[875,370],[906,368],[932,366],[957,364]],Ze=[[1070,359],[1096,356],[1121,354],[1146,352]],qe=[[637,557],[604,531],[571,502],[552,481],[530,462],[508,441],[483,419],[463,396],[441,375],[422,356],[408,335],[394,314],[378,291],[367,270],[361,250],[408,268],[447,279],[486,290],[527,302],[568,313],[610,320],[651,327],[673,306],[684,284],[690,263],[695,229],[695,200],[698,178],[734,190],[750,211],[764,232],[778,254],[789,277],[803,299],[825,319],[861,303],[872,281],[877,261],[883,240],[891,218],[908,197],[930,218],[935,239],[935,261],[938,283],[952,303],[968,283],[968,262],[966,241],[966,221],[971,199],[993,181],[1032,189],[1059,208],[1068,229],[1070,251],[1070,274],[1062,295],[1057,319],[1051,342],[1051,364],[1043,385],[1090,383],[1131,378],[1172,370],[1219,356],[1244,337],[1266,319],[1305,309],[1349,312],[1385,323],[1401,342],[1385,361],[1343,361],[1313,377],[1288,393],[1255,411],[1225,428],[1189,447],[1159,463],[1128,479],[1092,491],[1051,502],[1010,514],[971,524],[932,535],[894,543],[852,550],[811,554],[767,559],[726,561],[681,561],[640,561]],Ve=[[788,530],[752,514],[720,494],[692,472],[664,452],[636,432],[608,412],[576,392],[548,372],[520,350],[496,328],[476,306],[452,284],[436,260],[488,268],[532,278],[580,284],[628,286],[676,290],[720,280],[756,260],[788,240],[820,262],[844,284],[868,306],[884,282],[904,260],[924,238],[940,262],[944,286],[948,310],[980,288],[1004,266],[1020,242],[1036,266],[1048,292],[1068,314],[1112,328],[1164,332],[1212,322],[1260,314],[1308,306],[1356,298],[1400,286],[1448,294],[1496,306],[1540,318],[1508,338],[1468,352],[1428,366],[1392,382],[1352,398],[1312,412],[1272,428],[1232,444],[1192,458],[1140,468],[1092,480],[1048,490],[1e3,498],[952,504],[904,510],[856,518],[808,522]],$e=[[480,400],[521,397],[563,390],[604,381],[654,371],[695,364],[739,357],[781,354],[822,354],[866,354],[908,360],[949,368],[990,375],[1032,382],[1073,386],[1117,386]],je=[[748,568],[748,542],[748,517],[750,497],[759,476],[775,457],[811,443],[850,434],[891,433],[935,434],[977,436],[1021,441],[1054,455],[1046,434],[1046,414],[1048,393]],Ke=[[726,559],[726,538],[726,514],[726,490],[723,468],[717,443],[714,422],[659,415],[607,415],[557,415],[508,418],[560,418],[626,412],[690,408],[737,406],[778,404],[819,403],[866,403],[913,403]],Je=[[1321,367],[1319,346],[1360,342],[1393,354]],Qe=[[411,374],[458,360],[499,346],[532,331]],tr=[[375,331],[403,314],[439,302]],er=[[610,226],[651,226],[695,228]],rr=[[621,259],[662,259],[703,263]],ir=[[828,255],[872,255],[913,254]],nr=[[847,287],[888,287],[930,288]],or=[[954,247],[996,247]],sr=[[960,286],[1001,286],[1043,288]],ar=[[409,559],[395,565],[380,572],[365,576],[349,581],[334,586],[318,590],[303,593],[286,595],[269,597],[254,599],[238,601],[223,599],[207,597],[193,590],[178,583],[163,577],[148,569],[139,557],[131,544],[123,528],[118,512],[112,497],[108,481],[104,465],[101,449],[98,432],[94,416],[91,401],[86,385],[84,369],[80,354],[76,337],[69,321],[85,321],[97,332],[114,344],[128,352],[143,360],[158,367],[171,376],[184,385],[199,393],[215,398],[230,396],[232,381],[231,365],[230,350],[230,333],[233,316],[241,302],[257,305],[261,321],[263,336],[265,353],[268,368],[270,384],[279,397],[291,407],[299,392],[302,376],[303,360],[305,345],[309,329],[324,328],[327,344],[327,359],[327,375],[328,391],[331,407],[339,420],[354,416],[360,401],[362,385],[365,369],[369,354],[378,341],[394,337],[404,350],[410,364],[415,380],[418,395],[421,411],[421,426],[423,444],[424,460],[423,475],[422,492],[420,507]],cr=[[124,500],[138,492],[153,483],[168,475],[182,468],[196,460],[211,453],[227,449],[242,447],[258,446],[274,446],[289,448],[305,452],[320,455],[338,462],[353,466],[369,469],[384,472],[400,475],[416,474],[430,468],[444,460],[456,450],[468,441],[481,431],[495,424],[512,420],[527,420],[545,421],[561,426],[563,442],[549,450],[533,456],[517,461],[503,467],[492,479],[485,494],[480,509],[474,524],[459,538],[446,549],[429,559],[412,564]],lr=[[408,528],[395,520],[380,513],[364,509],[348,507],[333,506],[316,506],[301,505],[285,508],[269,513],[257,524],[251,538],[250,554],[254,569],[262,584],[278,591],[294,593],[310,593],[326,590],[344,586]],hr=[[116,507],[132,507],[148,506],[164,504],[179,502],[196,500],[211,497],[227,497],[242,497],[258,497],[275,498],[293,498],[310,498],[326,498],[343,498]],fr=[[225,466],[225,481],[225,498],[223,513],[222,529],[220,546],[219,562],[220,578],[223,593]],ur=[[523,456],[511,447],[522,436],[538,434],[550,443]],gr=[[80,438],[95,436],[112,435],[127,435]],mr=[[66,399],[82,398],[98,396],[114,396]],xr=[[58,361],[74,361],[89,359],[105,356]],dr=[[205,360],[221,365],[236,367],[252,368]],pr=[[204,335],[228,336],[244,337],[259,341]],yr=[[282,350],[296,359],[312,366]],vr=[[280,378],[295,380],[313,383],[328,386]],_r=[[343,373],[361,375],[376,376],[392,378]],br=[[346,403],[364,405],[379,407],[395,406]],Er=[[603,445],[593,458],[580,470],[569,481],[555,492],[541,501],[527,510],[514,519],[499,529],[486,537],[473,546],[458,555],[444,562],[428,568],[412,575],[397,580],[381,584],[366,589],[350,593],[335,598],[318,603],[302,606],[286,606],[270,606],[255,605],[239,601],[224,595],[208,588],[195,580],[184,567],[177,553],[172,537],[165,523],[159,507],[152,492],[148,474],[146,459],[142,442],[138,426],[132,412],[130,396],[127,381],[121,366],[116,350],[108,336],[105,321],[97,303],[89,284],[83,270],[98,273],[108,285],[120,297],[134,307],[146,317],[160,325],[175,333],[190,341],[204,350],[219,358],[233,352],[239,335],[246,320],[251,304],[258,319],[265,333],[274,348],[282,362],[290,377],[298,391],[305,377],[310,361],[316,345],[328,355],[337,370],[343,385],[350,399],[358,414],[369,399],[374,384],[380,368],[387,354],[391,369],[392,385],[394,401],[395,417],[397,433],[412,437],[428,430],[442,423],[457,416],[473,408],[486,399],[501,392],[516,397],[530,406],[543,414],[556,423],[571,431],[587,435],[600,443]],wr=[[676,699],[653,693],[632,678],[619,656],[614,632],[610,608],[607,583],[605,559],[601,533],[601,509],[601,485],[586,465],[563,460],[537,450],[515,438],[494,425],[472,415],[452,401],[432,386],[412,371],[392,357],[368,349],[382,329],[403,314],[426,311],[447,324],[458,346],[463,369],[485,360],[507,369],[524,390],[546,381],[570,377],[594,379],[616,388],[640,388],[664,386],[688,386],[711,386],[735,386],[756,373],[757,347],[761,322],[763,298],[768,274],[774,250],[779,224],[787,200],[790,175],[794,151],[803,129],[816,108],[840,114],[857,96],[868,74],[892,70],[914,79],[923,101],[934,79],[958,75],[976,94],[985,116],[989,140],[993,165],[996,189],[1e3,215],[1002,241],[1004,265],[1004,289],[1004,313],[1006,336],[1006,362],[1006,386],[1006,410],[1006,434],[1004,458],[1e3,482],[1022,471],[1044,458],[1066,445],[1088,434],[1108,421],[1129,408],[1147,392],[1165,375],[1189,373],[1211,384],[1233,395],[1252,412],[1274,421],[1298,425],[1309,447],[1285,449],[1259,456],[1235,461],[1211,469],[1188,476],[1164,485],[1140,487],[1116,493],[1092,502],[1074,518],[1059,539],[1042,559],[1024,577],[1006,594],[985,608],[965,621],[941,634],[919,643],[897,654],[875,667],[855,680],[831,686],[807,691],[783,693],[759,697]],Rr=[[438,386],[460,395],[482,404],[506,414],[529,423],[553,432],[575,443],[599,450],[621,460],[645,469],[669,476],[691,487],[713,498],[735,507],[759,517],[783,524],[805,533],[829,542],[851,555],[873,566],[895,579],[917,588],[939,597],[963,607]],Sr=[[632,647],[656,647],[680,640],[704,632],[726,623],[750,614],[774,608],[798,605],[822,597],[846,588],[869,581],[893,574],[917,566],[941,559],[965,551],[989,544],[1011,535],[1035,528],[1057,518],[1079,509],[1103,502],[1127,491],[1151,482],[1175,474],[1199,467],[1221,454],[1244,450]],Ar=[[750,695],[750,671],[750,645],[750,621],[750,597],[750,574],[748,548],[744,524],[744,500],[744,476],[743,452],[743,428],[741,404]],Pr=[[472,403],[496,403],[520,403],[544,403],[568,403],[592,403],[616,403],[640,401],[664,401],[688,401],[711,401],[735,401],[761,399],[785,395],[809,393],[833,392],[858,390],[884,390],[908,386],[932,384],[956,384],[980,384]],Ir=[[754,379],[763,357],[779,336],[794,316],[809,296],[824,276],[836,254],[849,232],[864,210],[875,188],[888,162],[901,140]],Mr=[[879,132],[888,156],[897,178],[908,202],[917,224],[928,246],[939,268],[947,292],[956,316],[965,338],[976,360],[991,381]],Tr=[[767,377],[770,353],[778,329],[783,305],[787,281],[790,257],[796,233],[800,210],[801,186],[803,162],[807,138],[831,132],[855,132],[879,129],[903,129],[926,129],[952,129],[976,129],[983,154],[983,178],[983,202],[985,230],[985,256],[985,281],[985,305],[987,331],[987,355],[987,379]],Lr=[[884,140],[884,164],[884,193],[884,221],[882,244],[882,268],[882,292],[881,318],[881,342],[881,368],[881,392],[881,417],[881,441],[881,465],[881,489],[881,515],[881,539],[881,563]],Cr=[[627,478],[627,504],[627,528],[629,551],[629,575],[629,599],[629,623],[642,643],[662,658],[684,671],[704,684],[724,697],[748,688],[770,676],[794,667],[818,660],[844,653],[868,645],[892,638],[915,629],[938,619],[961,612],[982,590],[1002,570],[1018,548],[1035,524],[1051,504],[1072,482],[1088,463],[1105,441],[1123,425],[1140,406]],kr=[[1287,447],[1261,445],[1239,432],[1219,419],[1195,412],[1171,403],[1149,393],[1158,415],[1167,439],[1171,463]],Nr=[[638,642],[658,627],[676,610],[695,594],[715,577],[735,563],[752,542],[772,528],[794,518],[814,504],[835,491],[857,480],[881,467],[903,454],[926,441],[949,428],[969,415],[989,403]],Or=[[768,399],[787,415],[807,428],[827,441],[847,454],[869,467],[892,480],[912,493],[932,506],[954,517],[974,531],[991,550],[991,574],[991,597]],Br=[[623,469],[647,461],[667,449],[691,439],[715,430],[737,419],[759,408]],Fr=[[748,689],[772,684],[792,671],[814,654],[835,640],[855,625],[875,608],[895,594],[915,581],[936,568],[956,555],[976,540],[998,529],[991,506],[991,482],[993,458],[994,434],[994,410],[994,386]],Xr=[[836,353],[835,366],[827,379],[820,390],[816,377],[822,364],[825,351],[831,338],[831,325],[831,313],[827,300],[840,296],[838,283],[849,290],[849,303],[862,300],[857,313],[857,325],[857,338],[857,351],[857,364],[847,355]],Dr=[[756,704],[746,682],[735,662],[721,645],[708,627],[697,607],[686,586],[673,568],[662,548],[653,528],[642,507],[632,487],[619,469],[599,458],[577,449],[555,443],[533,436],[511,428],[489,423],[469,414],[493,410],[518,410],[546,410],[570,410],[594,406],[618,401],[640,399],[662,397],[684,393],[706,392],[728,392],[750,390],[767,369],[779,349],[807,307],[825,279],[844,246],[857,228],[871,199],[884,176],[897,156],[910,178],[917,202],[925,228],[934,252],[941,276],[950,300],[960,320],[969,342],[980,362],[991,382],[994,406],[994,428],[993,450],[991,474],[985,496],[1006,485],[1026,471],[1044,456],[1061,441],[1079,428],[1097,415],[1116,401],[1134,388],[1160,393],[1182,397],[1204,404],[1226,412],[1246,423],[1267,432],[1289,438],[1267,445],[1244,450],[1222,458],[1202,467],[1180,474],[1160,483],[1138,491],[1118,500],[1096,509],[1074,517],[1051,522],[1029,526],[1007,529],[985,537],[969,553],[950,570],[932,583],[914,597],[895,610],[875,621],[853,634],[835,647],[813,662],[792,673],[774,686]],Yr=[[167,579],[190,568],[216,560],[241,551],[267,541],[293,532],[318,524],[344,515],[370,509],[397,506],[423,504],[449,502],[474,502],[500,506],[526,511],[551,519],[577,526],[603,532],[628,538],[656,547],[684,551],[709,556],[735,556],[763,558],[788,553],[816,547],[842,541],[868,532],[891,521],[919,511],[944,500],[970,494],[996,489],[1021,485],[1047,483],[1073,485],[1098,491],[1122,502],[1147,513],[1171,526],[1150,543],[1124,549],[1098,556],[1073,564],[1049,577],[1024,588],[1e3,598],[976,611],[957,628],[940,650],[927,673],[917,699],[906,722],[891,746],[876,769],[859,791],[838,806],[814,821],[791,835],[767,848],[744,859],[720,872],[694,880],[669,887],[643,893],[618,900],[588,904],[562,906],[536,910],[511,912],[485,912],[459,912],[434,912],[408,910],[382,906],[355,902],[329,897],[306,885],[288,865],[274,844],[261,818],[250,795],[235,769],[222,746],[212,722],[203,697],[194,671],[188,645],[182,620],[171,594],[160,571],[150,547],[137,521],[128,496],[118,470],[115,444],[111,419],[100,391],[90,368],[81,342],[71,316],[62,291],[88,295],[111,306],[137,316],[160,327],[186,333],[212,340],[237,346],[263,357],[288,365],[314,372],[340,376],[365,376],[391,368],[402,344],[408,316],[415,288],[421,261],[425,235],[425,209],[429,184],[442,160],[459,141],[479,158],[483,184],[487,209],[489,235],[491,261],[494,286],[498,312],[509,335],[534,329],[538,303],[545,278],[547,252],[553,224],[558,199],[564,173],[575,150],[590,128],[615,126],[626,150],[626,175],[628,201],[630,226],[630,256],[635,282],[639,308],[647,333],[665,353],[682,331],[688,306],[694,280],[703,252],[712,226],[722,201],[731,175],[741,152],[756,130],[776,147],[778,173],[778,199],[778,224],[778,254],[776,286],[776,312],[778,342],[778,368],[780,393],[780,419],[780,444],[780,470],[778,496],[776,521],[774,553],[774,579],[771,605],[769,630],[769,656],[767,682],[746,697],[720,697],[694,699],[669,699],[643,699],[615,699],[590,699],[564,699],[538,703],[513,707],[487,714],[462,720],[440,735],[419,750],[402,769],[385,791],[374,814],[363,838],[361,863],[363,889]],zr=[[201,630],[226,632],[254,632],[280,632],[312,632],[338,632],[365,632],[393,635],[419,637],[444,637],[472,637],[498,637],[528,637],[560,637],[585,637],[613,637],[641,635],[667,632],[692,630],[718,630],[744,628]],Ur=[[348,635],[348,660],[350,686],[353,714],[355,739],[355,765],[355,791],[357,816],[357,842],[357,870],[357,895]],Hr=[[761,274],[756,299],[752,325],[744,350],[739,376],[735,406],[731,434],[729,459],[722,485],[716,511],[697,528],[671,519],[643,513],[618,506],[592,500],[566,491],[543,481],[526,459],[502,449],[474,444],[449,442],[423,442],[393,444],[365,449],[340,451],[312,457],[286,464],[263,474],[239,489],[216,502],[194,517],[179,538],[173,564],[199,571],[220,553],[244,543],[267,532],[295,526],[323,517],[350,513],[380,509],[406,504],[432,500],[457,500],[485,504],[511,509],[536,517],[564,526],[590,532],[615,538],[643,545],[669,553],[694,558],[679,581],[654,575],[628,568],[603,579],[577,575],[551,571],[526,564],[496,566],[466,571],[438,566],[410,564],[385,566],[357,575],[325,579],[299,581],[274,588],[244,592],[214,594],[229,615],[254,620],[295,624],[321,622],[346,622],[380,626],[412,628],[447,628],[479,628],[509,630],[543,630],[571,630],[598,630],[628,628],[654,628],[679,628],[705,622],[731,620],[756,620],[761,647],[765,673],[761,699],[771,722],[750,739],[729,754],[701,754],[673,744],[645,739],[620,733],[594,731],[568,731],[543,729],[517,729],[502,750],[496,776],[494,801],[491,827],[491,853],[498,878],[519,893],[549,897],[575,902],[600,900],[626,897],[652,900],[677,895],[703,891],[729,887],[754,878],[778,865],[801,855],[825,842],[846,827],[865,810],[891,801],[897,776],[912,754],[919,729],[919,703],[919,677],[934,654],[953,637],[974,622],[998,609],[1021,594],[1017,568],[989,562],[964,560],[938,560],[912,562],[889,573],[868,588],[844,600],[829,622],[816,645],[812,671],[803,697],[788,718],[771,699],[769,673],[761,647],[761,622],[767,594],[776,568],[784,543],[795,519],[799,494],[791,468],[797,442],[799,417],[791,391],[795,365],[797,338],[793,312],[795,286],[784,263]],Gr=[[410,919],[438,919],[464,919],[489,919],[517,917],[543,915],[568,910],[594,906],[620,902],[645,900],[671,895],[697,891],[722,887],[748,882],[771,872],[793,857],[812,840],[831,818],[850,801],[872,784],[893,767],[917,750],[936,733],[962,718],[981,701],[1004,686],[1028,669],[1049,654],[1071,639],[1094,624],[1118,613],[1141,600],[1167,590],[1152,566],[1132,545],[1115,526],[1094,506],[1075,489],[1056,472],[1034,453],[1015,436],[989,427],[966,440],[942,453],[919,466],[895,476],[872,487],[848,500],[825,513],[808,489],[799,459],[788,436],[782,410],[776,382],[767,355],[759,327],[750,295],[744,265],[735,233],[729,207],[724,182],[701,197],[686,220],[673,244],[652,226],[641,201],[630,177],[620,154],[594,158],[579,179],[562,201],[547,222],[536,246],[521,267],[513,293],[494,276],[476,256],[459,237],[442,218],[425,199],[410,177],[397,201],[391,226],[385,252],[376,278],[370,303],[340,312],[310,308],[284,306],[259,303],[233,299],[207,295],[177,293],[152,288],[122,286],[94,284],[68,282],[43,280],[47,306],[58,333],[64,359],[71,385],[79,417],[88,444],[96,472],[105,498],[113,528],[122,556],[130,583],[143,613],[156,645],[167,675],[179,707],[190,731],[201,754],[212,778],[222,801],[233,825],[256,838],[282,853],[308,863],[331,876],[357,887],[382,897],[408,908]],Wr=[[1853,641],[1804,641],[1742,641],[1693,641],[1640,641],[1587,641],[1538,640],[1485,640],[1436,638],[1387,635],[1333,635],[1284,634],[1235,631],[1182,631],[1129,631],[1080,631],[1031,631],[978,631],[928,631],[875,635],[826,637],[777,637],[728,634],[679,632],[630,632],[581,632],[532,632],[483,632],[487,650],[532,657],[581,658],[634,663],[687,669],[736,676],[785,680],[834,682],[883,683],[933,680],[969,693],[969,711],[969,729],[961,747],[949,764],[941,781],[990,786],[1039,790],[1084,783],[1088,764],[1104,747],[1117,729],[1129,712],[1141,695],[1141,677],[1186,685],[1243,687],[1301,689],[1354,690],[1403,692],[1452,692],[1501,695],[1550,698],[1599,703],[1636,715],[1669,729],[1681,747],[1677,764],[1644,779],[1603,789],[1554,796],[1505,799],[1456,799],[1407,799],[1358,800],[1309,803],[1260,805],[1211,806],[1162,809],[1157,826],[1153,844],[1141,861],[1186,868],[1235,868],[1292,868],[1346,868],[1399,870],[1456,870],[1505,870],[1554,871],[1607,871],[1656,874],[1710,876],[1759,876],[1808,877],[1845,865],[1840,848],[1840,831],[1845,813],[1845,796],[1845,779],[1849,761],[1853,744],[1861,726],[1869,709],[1877,692],[1885,674],[1890,657]],Zr=[[151,635],[200,635],[249,635],[299,635],[348,631],[397,630],[446,632],[458,650],[409,656],[348,656],[294,657],[245,658],[196,658],[147,658],[151,641]],qr=[[753,575],[753,592],[802,598],[843,608],[888,616],[937,619],[982,627],[1031,624],[1088,616],[1137,609],[1178,599],[1182,582],[1145,569],[1096,564],[1047,559],[998,554],[953,562],[904,569],[855,569],[806,569],[757,570]],Vr=[[793,469],[818,485],[851,498],[896,505],[945,498],[994,492],[1047,491],[1096,493],[1145,495],[1194,499],[1239,509],[1268,492],[1280,473],[1231,472],[1182,473],[1133,473],[1080,473],[1031,475],[982,475],[933,469],[883,465],[834,466]],$r=[{pts:[[471,916],[456,916],[441,916],[426,916],[411,918],[397,920],[393,905],[393,890],[408,892],[423,892],[438,889],[453,888],[468,887],[468,872],[466,857],[466,842],[483,837],[498,834],[498,849],[498,864],[496,879],[495,894],[510,892],[525,892],[540,893],[555,894],[570,894],[565,909],[562,924],[547,920],[532,920],[517,921],[502,923],[502,938],[502,953],[501,968],[499,983],[484,984],[469,980],[470,965],[470,950],[470,935],[471,920]],cx:481,cy:909,span:177},{pts:[[200,996],[185,991],[171,985],[183,976],[198,969],[212,960],[227,954],[241,946],[254,939],[268,930],[282,924],[296,916],[283,908],[267,903],[253,897],[238,890],[221,885],[207,879],[192,873],[177,868],[162,863],[166,848],[172,834],[187,843],[202,850],[217,855],[232,860],[247,864],[262,869],[277,874],[292,880],[308,887],[323,892],[338,897],[353,900],[344,914],[330,921],[317,930],[304,939],[291,948],[278,956],[266,965],[252,974],[238,983],[224,990],[211,996],[196,995]],cx:257,cy:915,span:191}];function jr(t,e,r,i,n,o,s,a,c,l=1.5){return t.map((([t,f])=>{const u=f<c-80?.4*n:n*h(1,3),g=(t-a)*i+h(-u,u),m=(f-c)*i*l+h(-u,u);return[e+o*g-s*m,r+s*g+o*m]}))}function Kr(t=1082,e=436,r=1,i=!1,{requireFillOrErase:n=!1,brushOverride:o=null,colorOverride:s=null,rotationRange:a=Math.PI/7}={}){const c=h(1,5)*r,l=h(Se[0]+Se[1]+Se[2]+Se[3]+Se[4]),f=Se[0]+Se[1],u=f+Se[2],g=i||l<Se[0]?0:l<f?1:l<u?2:l<u+Se[3]?3:4,{outline:m,cx:x,cy:d,yStretch:p,eraseShape:y,eraseYStretch:v,interiors:_}=[{outline:Be,cx:1082,cy:436,yStretch:1.5,eraseShape:Fe,eraseYStretch:1.5,interiors:[[Xe,.15],[De,.3],[Ye,.3],[ze,.4],[Ue,.45],[He,.45],[Ge,.45],[We,.45],[Ze,.45]]},{outline:qe,cx:881,cy:370,yStretch:1.5,eraseShape:Ve,eraseYStretch:2,interiors:[[$e,.15],[je,.3],[Ke,.3],[Je,.4],[Qe,.45],[tr,.45],[er,.45],[rr,.45],[ir,.45],[nr,.45],[or,.45],[sr,.45]]},{outline:ar,cx:247,cy:451,yStretch:1,eraseShape:Er,eraseYStretch:1,interiors:[[cr,.15],[lr,.3],[hr,.3],[fr,.3],[ur,.4],[gr,.45],[mr,.45],[xr,.45],[dr,.45],[pr,.45],[yr,.45],[vr,.45],[_r,.45],[br,.45]]},{outline:wr,cx:839,cy:385,yStretch:1,eraseShape:Dr,eraseYStretch:1,interiors:[[Rr,.75],[Sr,.6],[Ar,.55],[Pr,.7],[kr,.65],[Ir,.75],[Mr,.75],[Tr,.75],[Lr,.75],[Cr,.75],[Nr,.75],[Or,.75],[Br,.75],[Fr,.75],[Xr,.3]]},{outline:Yr,cx:617,cy:519,yStretch:1,eraseShape:Gr,eraseYStretch:1,interiors:[[zr,.15],[Ur,.3],[Hr,.3,!0]]}][g],b=r*Ae[g],E=h(-a,a),w=Math.cos(E),R=Math.sin(E),S=o??h(we),A=s??h(Ee);let P=h(Ee);for(;P===A;)P=h(Ee);const I=jr(m,t,e,b,.3*c,w,R,x,d,p),M=r=>jr(r,t,e,b,c,w,R,x,d,p),T=h(1)<.3,L=!T&&(n||h(1)<.8),C=!T&&h(1)<.75,k=jr(y,t,e,b,.3*c,w,R,x,d,v);$(h(.1,3)),(T||L)&&(zt(),Q(Re,100),gt(k,.5),tt(),bt()),T&&(le(P,100),he(h(.03,.1)),fe(h(.1,.3),.15),gt(k,0),ue()),Yt(S,A,1.25),gt(I,1);for(const[t,,e]of _)e||gt(M(t),.5);if(zt(),C){ne(10*_e,h(-Math.PI/2,0),{rand:.15,continuous:!0,gradient:h(.1,.5)}),oe(S,A,1);for(const[t,e]of _)(i||h(1)>e)&&new rt(M(t)).hatch();se()}z(),N.field.isActive=!1}const Jr=Math.sqrt(795894.25),Qr=Array.from({length:12},(()=>h(...Ie)*_e)),ti=function(t,e,r,i,n=80){const o=[];for(let s=0;s<t;s++){let t=null,a=-Infinity;for(let c=0;c<n;c++){const n=h(.05*r,.95*r),c=h(.05*i,.95*i);let l=Infinity;for(let t=0;t<o.length;t++){const r=.7*(Jr*e[s]+Jr*e[t]);l=Math.min(l,Math.hypot(n-o[t][0],c-o[t][1])-r)}if(l>=0){t=[n,c];break}l>a&&(a=l,t=[n,c])}o.push(t)}return o}(12,Qr,pe,ye);let ei=0;function ri({pts:t,cx:e,cy:r,span:i},n,o){const s=Math.min(pe,ye)*h(...ke)/i,a=h(-Math.PI/20,Math.PI/20),c=Math.cos(a),l=Math.sin(a);return t.map((([t,i])=>{const a=(t-e)*s,h=(i-r)*s;return[n+c*a-l*h,o+l*a+c*h]}))}const ii=h(1)<.3,ni=h(1)<.25;((...t)=>{F(),D=new B(...t),X.worker.postMessage({color:D.gl,isBG:!0})})(Re),$(1),ii?function(){$(0);const t=new Set,e=()=>{let e;do{e=h(Ee)}while(t.has(e));return t.add(e),e},r=e(),i=e(),n=e(),o=(t,e=0)=>{ct(e),lt(t[0][0],t[0][1]);for(let e=1;e<t.length;e++)ht(t[e][0],t[e][1]);ft(),ut()},s=(t,e,r=0,i)=>{zt(),i?(Q(Re,100),o(t,r),tt(),bt(),le(e,150),he(.05),fe(.1,.15)):(Q(e,100),o(t,r),bt(),tt()),o(t,r),ue(),bt(),tt(),se()},a=h(.52,.65),c=pe*h(.04,.08),l=ye*h(.04,.08),f=.02*Math.min(pe,ye),u=h(1)>.5?c:-f,g=h(1)>.5?pe-c:pe+f,m=h(1)>.5?l:-f,x=ye*a,d=.005*Math.min(pe,ye),p=(t,e,r,i,n,o)=>Array.from({length:5},((s,a)=>{const c=(a+1)/6;return[t+(r-t)*c+h(-n,n),e+(i-e)*c+h(-o,o)]}));s([[u,m],...p(u,m,g,m,.3*d,d),[g,m],...p(g,m,g,x,d,.3*d),[g,x],...p(g,x,u,x,.3*d,d),[u,x],...p(u,x,u,m,d,.3*d)],r);const y=h(.62*pe,.85*pe),v=h(.04*ye,.2*ye),_=pe*h(...Ne),b=ye*h(...Oe),E=Array.from({length:8},((t,e)=>{const r=e/8*Math.PI*2;return[y+Math.cos(r)*_*h(.75,1.25),v+Math.sin(r)*b*h(.75,1.25)]}));s(E,i,h(.6,1),!0);const w=(g-u)/1743,R=(u+g)/2,S=ye*h(.65,.7),A=2*w,P=t=>jr(t,R,S,w,A,1,0,1019,671,2.4);s(P(Wr),n,1);const I=(t,e,r=0)=>{const i=h(.65,1.35),n=h(3,10);return t.map((([t,o])=>[e+(t-e)*i+r+h(-6,6),o+h(-n,n)]))},M=[{shape:Zr,cx:305,xShift:0},{shape:qr,cx:968,xShift:h(-120,120)},{shape:Vr,cx:1031,xShift:h(-120,120)}];for(const{shape:t,cx:e,xShift:r}of M)h(1)>.4&&s(P(I(t,e,r)),n,1);for(const t of $r)h(1)>.5&&s(ri(t,h(u,g),h(m,x)),i);bt()}():function(){const t=Math.floor(h(3,6)),e=[],r=new Set;for(;e.length<t;){const d=h(Ee);r.has(d)||(r.add(d),e.push(d))}const i=(t,e)=>{const r=pe*h(...Me),i=ye*h(...Te),n=t-r/2,o=e-i/2,s=.06*Math.min(r,i),a=[[n+h(-s,s),o+h(-s,s)],[n+r+h(-s,s),o+h(-s,s)],[n+r+h(-s,s),o+i+h(-s,s)],[n+h(-s,s),o+i+h(-s,s)]],c=.0015*Math.min(pe,ye),l=((t,e=50)=>{const r=[];for(let i=0;i<t.length;i++){const[n,o]=t[i],[s,a]=t[(i+1)%t.length],c=Math.max(1,Math.ceil(Math.hypot(s-n,a-o)/e));for(let t=0;t<c;t++)r.push([n+t/c*(s-n),o+t/c*(a-o)])}return r})(a,160).map((([t,e])=>[t+h(-c,c),e+h(-c,c)]));return{curved:!1,pts:l}},n=(t,e)=>{const r=pe*h(...Le),i=ye*h(...Le);return{curved:!0,pts:Array.from({length:8},((n,o)=>{const s=o/8*Math.PI*2;return[t+Math.cos(s)*r*h(.7,1.3),e+Math.sin(s)*i*h(.7,1.3)]}))}},o=[i,i,n,n,n],s=[],a=Math.floor(h(2,3)),c=h(.15*pe,.85*pe),l=h(.15*ye,.85*ye),f=.26*Math.min(pe,ye);for(let p=0;p<a;p++)s.push([c+h(-f,f),l+h(-f,f)]);const u=Math.floor(h(2,6)),g=.35*Math.min(pe,ye);for(let y=0;y<u;y++){let v=null,_=-Infinity;for(let b=0;b<60;b++){const E=h(.05*-pe,1.05*pe),w=h(.05*-ye,1.05*ye);let R=Infinity;for(const[S,A]of s)R=Math.min(R,Math.hypot(E-S,w-A)-g);if(R>=0){v=[E,w];break}R>_&&(_=R,v=[E,w])}s.push(v)}const m=s.map((([t,r])=>({shape:o[Math.floor(h(o.length))](t,r),color:h(e)})));for(const P of $r)h(1)>.5&&m.push({shape:{curved:!1,pts:ri(P,h(.05*pe,.95*pe),h(.05*ye,.95*ye))},color:h(e)});const x=[...m.filter((t=>!t.shape.curved)),...m.filter((t=>t.shape.curved))];for(const{shape:I,color:M}of x){function T(){ct(I.curved?h(.6,1):0),lt(I.pts[0][0],I.pts[0][1]);for(let t=1;t<I.pts.length;t++)ht(I.pts[t][0],I.pts[t][1]);ft(),ut()}zt(),h(1)>.65||I.curved?(Q(Re,100),T(),tt(),bt(),le(M,150),he(.05),fe(.1,.05)):(Q(M,100),T(),bt(),tt()),T(),ue(),se(),bt()}}(),be||(ne(300*_e,Math.PI/4,{rand:.1}),oe("spray",Re,8),function(t,e,r,i,n="corner"){"center"===n&&(t-=r/2,e-=i/2),ct(0),lt(t,e),ht(t+r,e),ht(t+r,e+i),ht(t,e+i),ft(),ut()}(.05*-pe,.05*-ye,1.1*pe,1.1*ye),se(),bt());const oi=[];let si=!1;vt(be?1:8),function(t=!1){t&&(xt=t),pt=!0,setTimeout((()=>{requestAnimationFrame(_t)}),"200")}((()=>{if(si){if(oi.length>0){const[t,e]=oi.shift();Kr(t,e,h(...Ie)*_e)}}else if(ni){si=!0,vt(10),window.dispatchEvent(new CustomEvent("sketch:done"));const t=1059;Kr(pe*h(.43,.57),ye*h(.38,.5),ye*h(...Ce)/t,!1,{requireFillOrErase:!0,brushOverride:"charcoal",colorOverride:"#080f15",rotationRange:Math.PI/10})}else{if(ei>=12)return si=!0,vt(10),void window.dispatchEvent(new CustomEvent("sketch:done"));const[t,e]=ti[ei],r=11===ei;ei++,Kr(t,e,Qr[ei-1],r)}})),document.querySelector("canvas").addEventListener("click",(t=>{if(!si)return;const e=Math.max(window.innerWidth/pe,window.innerHeight/ye),r=(window.innerWidth-pe*e)/2,i=(window.innerHeight-ye*e)/2;oi.push([(t.clientX-r)/e,(t.clientY-i)/e])}))},"function"==typeof define&&define.amd?define(t):t();
